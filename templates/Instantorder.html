<link rel="stylesheet" href="{$wa_url}wa-content/css/jquery-ui/jquery-ui-1.7.2.custom.css" />
<script src="{$wa_app_static_url}plugins/instantorder/js/jquery-ui.min.js"></script>
<style>
    #instantorder_dialog{
        display: none;
    }
    #instantorder_table{
        margin: 0 auto;
    }
    .select_countries{
        width: 180px;
    }
    #instantorder_table input[type=text]{
        width: 200px;
    }
</style>
<script type='text/javascript'>
            $(function() {
                $('.instantorder_button').click(function() {
                    $('#instantorder_dialog').dialog({
                    title: '{$settings.title}',
                            width: {$settings.width_modal},
                            height: {$settings.height_modal},
                            modal: true,
                            autoOpen: true,
                    });
                });
                
                $('#instantorder_form').submit(function(event){
                    event.preventDefault();
                    var required = false;
                    $('.required_field').each(function(){
                        if(!$(this).val().length) {
                            required = true;
                            $(this).css('border', '2px solid red');
                          }
                    });
                    if(required) {
                        $('.response').html('Заполните обязательные поля');
                        $('.response').css('color', 'red');
                        $('.response').show();
                        $('.response').hide(5000);
                        setTimeout(function(){
                            $('.required_field').css('border', '');
                        },5000);
                    } else {
                        $.ajax({
                            type: 'POST',
                            url: $(this).attr('action'),
                            dataType: 'json',
                            data: $(this).serialize() + '&' + $('#cart-form').serialize(),
                            success: function(data, textStatus, jqXHR) {
                                $('.response').html(data.data.message);
                                $('.response').show();
                                $('.response').hide(5000);
                            }
                        });
                    }
                });                
                                
                
                
            });
</script>


<div class="instantorder_block">
    <a class="instantorder_button" href="javascript:void(0);"><img src="{$wa_app_static_url}plugins/instantorder/img/instantorder_but.gif" title="{$settings.link_name}"/></a>

    <div id="instantorder_dialog">
        <form id="instantorder_form" action="{$wa_app_url}instantorder/">
            <table  id="instantorder_table">
                {foreach from=$selected_fields item=selected_field}
                <tr>
                    <td>{$selected_field.name}{if $selected_field.required}<span class="required">*</span>{/if}:&nbsp;</td>
                    <td>
                        {if $selected_field.type!='address.country'}
                        <input {if $selected_field.required}class="required_field"{/if} type="text" name="fields[{$selected_field.type}]" value="{if isset($selected_field.def_value)}{$selected_field.def_value}{/if}" />
                        {else}
                        <select class="select_countries{if $selected_field.required} required_field{/if}" name="fields[{$selected_field.type}]" >
                            <option value="">Выберите страну</option>
                            {foreach from=$countries key=key item=country}
                            <option value="{$key}"  {if isset($selected_field.def_value) && $selected_field.def_value==$key}selected="selected"{/if}>{$country.name}</option>
                            {/foreach}
                        </select>
                        {/if}
                    </td>
                </tr>
                {/foreach}
                <tr>
                    <td colspan="2" align="center" >
                        <input type="submit" value="Оформить заказ"/>
                    </td>
                </tr>

                <tr>
                    <td colspan="2" align="center" class="response" >
                        
                    </td>
                </tr>
            </table>
        </form>

    </div>
</div>

